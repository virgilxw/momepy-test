(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(4472)}])},4472:function(e,t,l){"use strict";l.r(t),l.d(t,{__N_SSG:function(){return k},default:function(){return I}});var s=l(5893),r=l(183),i=l.n(r);l(3982);var a=l(7294),n=l(3403);function c(e){let{data:t}=e;return t&&0!==t.length?t.length>8?(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-4",children:[(0,s.jsx)("div",{children:t.slice(0,Math.ceil(t.length/2)).map((e,t)=>{let[l,r]=e;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{style:{backgroundColor:r},className:"w-6 h-3 border rounded"}),(0,s.jsx)("div",{className:"text-xs",children:l})]},l+t)})}),(0,s.jsx)("div",{children:t.slice(Math.ceil(t.length/2)).map((e,t)=>{let[l,r]=e;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{style:{backgroundColor:r},className:"w-6 h-3 border rounded"}),(0,s.jsx)("div",{className:"text-xs",children:l})]},l+t)})})]}):(0,s.jsx)("div",{className:"grid grid-cols-2 gap-x-4",children:(0,s.jsx)("div",{children:t.map((e,t)=>{let[l,r]=e;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("div",{style:{backgroundColor:r},className:"w-6 h-3 border rounded"}),(0,s.jsx)("div",{className:"text-xs",children:l})]},l+t)})})}):null}var o=a.memo(function(e){let{selectedVar:t,setSelectedVar:l,selectedVarScale:r,setSelectedVarScale:i,selectedCity:n,setSelectedCity:o}=e,[d,u]=(0,a.useState)(null);return(0,a.useEffect)(()=>{fetch("panel-description.json").then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{u(e)}).catch(e=>{console.error("Error:",e)})},[t]),(0,s.jsx)("div",{className:"control-panel container mx-auto",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("div",{className:"w-3/4 p-4",children:[(0,s.jsxs)("h3",{children:["Displayed Variable: ",d&&d[t]?d[t].name:"N/A"," "]}),(0,s.jsx)("p",{children:d&&d[t]?d[t].description:"No description available"})]}),(0,s.jsxs)("div",{className:"w-1/4 py-4 px-8 text-right",children:[(0,s.jsx)("h1",{children:"Legend"}),d&&(0,s.jsx)(c,{data:r})]})]})})});let d={id:"tess",type:"fill","source-layer":"trees",paint:{"fill-outline-color":"rgba(0,0,0,0.1)","fill-color":"rgba(253, 253, 253, 0.1)"}},u={id:"tess-highlighted",type:"fill",source:"tess","source-layer":"trees",paint:{"fill-outline-color":"#484896","fill-color":"#6e599f","fill-opacity":.75}},h={id:"tess-selected",type:"fill",source:"tess","source-layer":"trees",paint:{"fill-outline-color":"#ff0000","fill-color":"#ffa4a4","fill-opacity":.4}};var m=l(2252),x=e=>{let{selectedCell:t,setSelectedCell:l,clusterID:r,setclusterID:i,selectedVar:c,setSelectedVar:x,selectedVarScale:f,setSelectedVarScale:p,selectedCity:g,setSelectedCity:y,citiesList:j,setCitiesList:b}=e,[v,N]=(0,a.useState)(103.851959),[_,w]=(0,a.useState)(1.29027),[S,k]=(0,a.useState)(15),[I,C]=(0,a.useState)(null),[D,E]=(0,a.useState)(null),[V,T]=(0,a.useState)(null),[A,L]=(0,a.useState)(null),{mapID:M}=(0,n.Sx)(),W=(0,a.useCallback)(e=>{let t=e.features&&e.features[0];T({longitude:e.lngLat.lng,latitude:e.lngLat.lat,cellName:t&&t.properties.uID,clusterID:t&&t.properties.clusterID,props:t&&t.properties})},[]),B=V&&V.cellName||"",O=(0,a.useMemo)(()=>["in","uID",B],[B]),F=(0,a.useCallback)(e=>{let t=e.features&&e.features[0];if(L({longitude:e.lngLat.lng,latitude:e.lngLat.lat,cellName:t&&t.properties.uID,clusterID:t&&t.properties.clusterID,props:t&&t.properties}),t&&t.properties){let{cluster_ID:e,uID:s}=t.properties;i({clusterID:Number(e),uID:Number(s)});let r=t.properties;delete r.cluster_ID,delete r.uID,l(r)}else l({nothing_selected:"Select a Cell to Continue"})},[]),z=A&&A.cellName||"",U=(0,a.useMemo)(()=>["in","uID",z],[z]),[R,Z]=(0,a.useState)(null),[P,Y]=(0,a.useState)({"fill-outline-color":"rgba(0,0,0,0.1)","fill-color":"rgba(0,0,0,0.1)"}),H=(0,a.useMemo)(()=>P,[P]);return(0,a.useEffect)(()=>{fetch("layerDirectory.json").then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{b(Object.keys(e)),E(e)}).catch(e=>{console.error("Error:",e)})},[]),(0,a.useEffect)(()=>{fetch("weighted_mean.json").then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{Z(e)}).catch(e=>{console.error("Error:",e)})},[]),(0,a.useEffect)(()=>{fetch("jenks.json").then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{C(e),console.log("%cmap.tsx line:157 data","color: #007acc;",e)}).catch(e=>{console.error("Error:",e)})},[]),(0,a.useEffect)(()=>{M&&g&&D&&M.flyTo({center:D[g].lnglat,duration:1e4})},[M,g,D]),(0,a.useEffect)(()=>{if("one_dimensional_diff_between_clusters"===c&&R){Object.keys(R[g]).length;let e=m.ABA(e=>m.BT8(1-e)).domain([-10,0,10]),t=function(e,t,l){let s=(10-e)/15,r=Array.from({length:16},(t,r)=>{let i=e+r*s,a=Number(i.toPrecision(3));return[a,l(i)]});return r}(-10,0,e);Y({"fill-color":{property:"one_dimensional_diff_between_clusters",stops:t},"fill-opacity":.8}),p(t)}else if("cluster_ID"===c&&R){let e=Object.keys(R[g]).length,t=m.ABA(e=>m.BT8(1-e)).domain([0,e/2,e]),l=Array(e).fill(null).map((e,l)=>[l,t(l)]);Y({"fill-color":{property:"cluster_ID",stops:l},"fill-opacity":.8}),p(l)}else if(null!=I){let e=I[g][c].classes,t=Number(I[g][c].min),l=Number(I[g][c].max),s=e.length,r=m.ABA(e=>m.BT8(1-e)).domain([0,s/2,s]),i=[];i.push(r(t)),e.forEach((e,t)=>{let[l,s]=e,a=r(t);i.push(l,a)}),i.push(Number(l),r(s)),Y({"fill-color":["step",["get",c],...i],"fill-opacity":.8}),p((e=>{let t=[];for(let l=0;l<e.length;l+=2)t.push(["<"+Math.round(1e3*e[l+1])/1e3,e[l]]);return t.slice(1,t.length-1)})(i))}},[c,R,I,g]),(0,s.jsxs)(s.Fragment,{children:[D&&(0,s.jsx)(n.ZP,{initialViewState:{latitude:_,longitude:v,zoom:S},minZoom:14,mapStyle:"mapbox://styles/mapbox/light-v9",mapboxAccessToken:"pk.eyJ1IjoidmlyZ2lseHciLCJhIjoiY2xncjR3cWg5MTU3NTNwbXRvZGR1YTB0aCJ9.3BvcTt_rt9WSPpePiM3kQw",onMouseMove:W,onClick:F,interactiveLayerIds:["tess"],id:"mapID",children:(0,s.jsxs)(n.Hw,{type:"vector",url:D[g].tess,children:[(0,s.jsx)(n.mh,{...d,paint:H}),(0,s.jsx)(n.mh,{...u,filter:O}),(0,s.jsx)(n.mh,{...h,filter:U})]})}),(0,s.jsx)(o,{selectedVar:c,setSelectedVar:x,selectedVarScale:f,setSelectedVarScale:p,selectedCity:g,setSelectedCity:y})]})},f=l(4076),p=l(7106),g=l(7349),y=l(4184),j=l.n(y),b=e=>{let{selectedCity:t,setSelectedCity:l,citiesList:r,setCitiesList:i}=e;return(0,s.jsxs)("nav",{className:j()({"bg-white text-zinc-500":!0,"flex items-center":!0,"w-full fixed z-10 px-4 shadow-sm h-16":!0}),children:[(0,s.jsx)("div",{className:"font-bold text-lg pr-4",children:"Urban Morphology Explorer"}),(0,s.jsxs)(f.v,{as:"div",className:"relative inline-block text-left",children:[(0,s.jsx)("div",{children:(0,s.jsxs)(f.v.Button,{className:"inline-flex w-full justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 w-40 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[t,(0,s.jsx)(g.Z,{className:"-mr-1 h-5 w-5 text-gray-400","aria-hidden":"true"})]})}),(0,s.jsx)(p.u,{as:a.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,s.jsx)(f.v.Items,{className:"absolute right-0 z-10 mt-2 w-40 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:(0,s.jsx)("div",{className:"py-1",children:r.filter(e=>e!==t).map(e=>(0,s.jsx)(f.v.Item,{children:t=>{let{active:r}=t;return(0,s.jsx)("a",{href:"#",className:j()(r?"bg-gray-100 text-gray-900":"text-gray-700","block px-4 py-2 text-sm"),onClick:()=>l(e),children:e})}},e))})})})]})]})};let v=e=>{let{data:t,xScale:l,height:r,binNumber:i,targetValue:a}=e,n=Math.min(...t),c=Math.max(...t),o=m.Ly_().domain([n,c]).thresholds(l.ticks(i)).value(e=>e),d=o(t),u=Math.max(...d.map(e=>e.length)),h=m.BYU().domain([-u,u]).range([0,r]),x=m.SOn().y0(e=>h(-e.length)).y1(e=>h(e.length)).x(e=>l(e.x0||0)).curve(m.u93),f=x(d);return null===a||Array.isArray(a)&&a.some(e=>null==e)?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("path",{d:f||void 0,opacity:1,stroke:"#9a6fb0",fill:"#9a6fb0",fillOpacity:.1,strokeWidth:2})}):Array.isArray(a)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{d:f||void 0,opacity:1,stroke:"#9a6fb0",fill:"#9a6fb0",fillOpacity:.1,strokeWidth:2}),(0,s.jsx)("line",{x1:l(a[1]),y1:0,x2:l(a[1]),y2:r,stroke:"red"},a[1]),(0,s.jsx)("rect",{x:l(a[0]),y:0,width:l(a[2])-l(a[0]),height:r,fill:"red",fillOpacity:.1,strokeWidth:1,stroke:"red"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{d:f||void 0,opacity:1,stroke:"#9a6fb0",fill:"#9a6fb0",fillOpacity:.1,strokeWidth:2}),!Array.isArray(a)&&null!==a&&(0,s.jsx)("line",{x1:l(a),y1:0,x2:l(a),y2:r,stroke:"red"})]})};var N=e=>{let{city_data:t,width:l,height:r,plotKey:i,targetValue:n}=e,[c,o]=(0,a.useState)(null),[d,u]=(0,a.useState)(()=>(0,m.BYU)());return((0,a.useEffect)(()=>{if(t&&void 0!=t[i]){let e=t[i].map(Number).filter(e=>!isNaN(e));if(void 0!=e){let t=(0,m.VRg)(e.sort(),.05),s=(0,m.VRg)(e,.95);if(void 0!==t&&void 0!==s){let r=(0,m.BYU)().domain([t,s]).range([0,.8*l]);o(e),u(()=>r)}}}},[]),c&&d)?(0,s.jsx)("svg",{style:{width:l,height:2*r},children:(0,s.jsx)("g",{transform:"translate(".concat(.1*l,", ").concat(r,")"),children:(0,s.jsx)(v,{height:r,xScale:d,data:c,binNumber:25,targetValue:n})})}):(0,s.jsx)("div",{children:"Loading..."})};function _(e){let{city_data:t,width:l,height:r,plotKey:i,targetValues:n}=e;return(0,s.jsxs)(f.v,{as:"div",className:"relative mt-5 text-left",children:[(0,s.jsx)("div",{children:(0,s.jsxs)(f.v.Button,{className:"inline-flex w-full justify-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:["Details",(0,s.jsx)(g.Z,{className:"-mr-1 h-5 w-5 text-gray-400","aria-hidden":"true"})]})}),(0,s.jsx)(p.u,{as:a.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,s.jsx)(f.v.Items,{className:"absolute right-0 z-10 mt-2 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none w-full",children:(0,s.jsxs)("div",{className:"py-1",children:[(0,s.jsx)(f.v.Item,{children:(0,s.jsx)("p",{className:"text-gray-700 block px-4 py-2 text-sm",children:"THIS VARIABLE MEASURES THE X Y Z"})}),(0,s.jsx)(f.v.Item,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-gray-700 block px-4 py-2 text-sm",children:"Distribution of nearby cells"}),(0,s.jsx)(N,{city_data:t,width:l,height:r,plotKey:i,targetValue:[n[25],n[50],n[75]]})]})}),(0,s.jsx)(f.v.Item,{children:(0,s.jsx)("p",{className:"text-gray-700 block px-4 py-2 text-sm",children:"Note: The violin plot is generated from a random sample of values, outlier values may therefore be higher or lower than the plot."})})]})})})]})}var w=e=>{let{city_data:t,selectedCell:l,setSelectedCell:r,clusterID:i,setclusterID:n,selectedVar:c,setSelectedVar:o,selectedVarScale:d,setSelectedVarScale:u,selectedCity:h,setSelectedCity:m}=e,[x,f]=(0,a.useState)({}),p=e=>e.endsWith("_25")||e.endsWith("_50")||e.endsWith("_75"),g=()=>{let e={},l=t[h];for(let t in delete l.cluster_ID,delete l.uID,delete l.one_dimensional_diff_between_clusters,l)p(t)||(e[t]={25:null,50:null,75:null,base:null});f(e)};return(0,a.useEffect)(()=>{g()},[h]),(0,a.useEffect)(()=>{if(!Object.keys(l).includes("nothing_selected")){let e={},s=t[h];delete s.cluster_ID,delete s.uID,delete s.one_dimensional_diff_between_clusters;let r=e=>e.endsWith("_25")||e.endsWith("_50")||e.endsWith("_75");for(let t in s)r(t)||(e[t]={25:null,50:null,75:null,base:null});for(let t in l)"one_dimensional_diff_between_clusters"!==t&&"uID"!==t&&"cluster_ID"!==t&&(t.endsWith("_25")?e[t.slice(0,-3)][25]=Number(l[t]):t.endsWith("_50")?e[t.slice(0,-3)][50]=Number(l[t]):t.endsWith("_75")?e[t.slice(0,-3)][75]=Number(l[t]):e[t].base=Number(l[t]));f(e)}},[l]),(0,s.jsxs)("div",{className:"sidebar shadow-md bg-zinc-50 overflow-y-auto",children:[(0,s.jsxs)("h2",{children:["cell uID: ",i.uID," "]}),(0,s.jsxs)("h3",{children:["ClusterID: ",i.clusterID," "]}),(0,s.jsxs)("div",{className:"inline-flex px-2",children:[(0,s.jsx)("button",{onClick:()=>o("cluster_ID"),className:"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-l ".concat("cluster_ID"===c?"bg-gray-400":""),children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{children:"Urban Type"}),(0,s.jsx)("span",{children:"Equal Intervals"})]})}),(0,s.jsx)("button",{onClick:()=>o("one_dimensional_diff_between_clusters"),className:"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-r ".concat("one_dimensional_diff_between_clusters"===c?"bg-gray-400":""),children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{children:"Urban Type"}),(0,s.jsx)("span",{children:"1-Dimension"})]})})]}),x&&Object.keys(x).length>0?Object.entries(x).map(e=>{let[l,r]=e;return(0,s.jsxs)("div",{className:"p-4 border mb-4 ".concat(c===l?"bg-gray-400":""),onClick:()=>o(l),children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-2",children:l}),(0,s.jsx)("p",{children:r.base}),(0,s.jsx)(N,{city_data:t[h],width:266,height:50,plotKey:l,targetValue:r.base}),(0,s.jsx)(_,{city_data:t[h],width:266,height:50,plotKey:l,targetValues:r})]},l)}):null]})},S=e=>(0,s.jsxs)("div",{className:"grid min-h-screen grid-rows-header bg-zinc-100",children:[(0,s.jsx)("div",{className:"bg-white shadow-sm z-10",children:(0,s.jsx)(b,{selectedCity:e.selectedCity,setSelectedCity:e.setSelectedCity,citiesList:e.citiesList,setCitiesList:e.setCitiesList})}),(0,s.jsxs)("div",{className:"grid md:grid-cols-sidebar ",children:[(0,s.jsx)(w,{selectedCell:e.selectedCell,setSelectedCell:e.setSelectedCell,city_data:e.city_data,clusterID:e.clusterID,setclusterID:e.setclusterID,selectedVar:e.selectedVar,setSelectedVar:e.setSelectedVar,selectedVarScale:e.selectedVarScale,setSelectedVarScale:e.setSelectedVarScale,selectedCity:e.selectedCity,setSelectedCity:e.setSelectedCity}),e.children]})]}),k=!0,I=e=>{let{city_data:t,selectedCell:l,setSelectedCell:r,clusterID:a,setclusterID:n,selectedVar:c,setSelectedVar:o,selectedVarScale:d,setSelectedVarScale:u,selectedCity:h,setSelectedCity:m,citiesList:f,setCitiesList:p}=e;return(0,s.jsx)(S,{city_data:t,selectedCell:l,setSelectedCell:r,clusterID:a,setclusterID:n,selectedVar:c,setSelectedVar:o,selectedVarScale:d,setSelectedVarScale:u,selectedCity:h,setSelectedCity:m,citiesList:f,setCitiesList:p,children:(0,s.jsx)("main",{className:"flex min-h-[16] flex-col items-center ".concat(i().className),children:(0,s.jsx)(x,{selectedCell:l,setSelectedCell:r,clusterID:a,setclusterID:n,selectedVar:c,setSelectedVar:o,city_data:t,selectedVarScale:d,setSelectedVarScale:u,selectedCity:h,setSelectedCity:m,citiesList:f,setCitiesList:p})})})}}},function(e){e.O(0,[513,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);